(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fd590c6c"],{"0ccb":function(t,e,a){var n=a("50c4"),s=a("1148"),r=a("1d80"),i=Math.ceil,o=function(t){return function(e,a,o){var l,p,u=String(r(e)),c=u.length,d=void 0===o?" ":String(o),f=n(a);return f<=c||""==d?u:(l=f-c,p=s.call(d,i(l/d.length)),p.length>l&&(p=p.slice(0,l)),t?u+p:p+u)}};t.exports={start:o(!1),end:o(!0)}},1148:function(t,e,a){"use strict";var n=a("a691"),s=a("1d80");t.exports="".repeat||function(t){var e=String(s(this)),a="",r=n(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(a+=e);return a}},2220:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("提交申訴")])]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.hasSuspension?a("div",[a("el-alert",{attrs:{title:"您當前被停權，無法借閱圖書",type:"error","show-icon":"",closable:!1}},[a("p",[t._v("停權原因: "+t._s(t.suspensionReason))]),a("p",[t._v("停權開始時間: "+t._s(t.formatDate(t.suspensionStartDate)))]),a("p",[t._v("停權結束時間: "+t._s(t.formatDate(t.suspensionEndDate)))])]),a("el-form",{ref:"appealForm",staticStyle:{"margin-top":"20px"},attrs:{model:t.appealForm,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"申訴原因",prop:"appealContent"}},[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"請詳細說明您的申訴理由..."},model:{value:t.appealForm.appealContent,callback:function(e){t.$set(t.appealForm,"appealContent",e)},expression:"appealForm.appealContent"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.submitAppeal}},[t._v("提交申訴")]),a("el-button",{on:{click:t.resetForm}},[t._v("重置")])],1)],1)],1):a("el-alert",{attrs:{title:"您當前沒有被停權，無需提交申訴",type:"info","show-icon":"",closable:!1}})],1)]),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("申訴記錄")]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:t.fetchAppeals}},[t._v("刷新")])],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.appealsLoading,expression:"appealsLoading"}]},[t.appeals.length>0?a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.appeals,border:""}},[a("el-table-column",{attrs:{prop:"createTime",label:"提交時間",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.formatDate(e.row.createTime,!0))+" ")]}}],null,!1,1891607840)}),a("el-table-column",{attrs:{prop:"appealContent",label:"申訴內容","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"status",label:"狀態",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.getStatusType(e.row.status)}},[t._v(" "+t._s(t.getStatusText(e.row.status))+" ")])]}}],null,!1,2263538733)}),a("el-table-column",{attrs:{prop:"adminReply",label:"管理員回覆","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"replyTime",label:"回覆時間",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.replyTime?t.formatDate(e.row.replyTime,!0):"-")+" ")]}}],null,!1,1117185881)}),a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.viewAppealDetails(e.row)}}},[t._v("查看詳情")])]}}],null,!1,156637519)})],1):a("div",{staticClass:"empty-result"},[a("i",{staticClass:"el-icon-document"}),a("p",[t._v("暫無申訴記錄")])])],1)]),a("el-dialog",{attrs:{title:"申訴詳情",visible:t.dialogVisible,width:"50%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"appeal-details"},[a("div",{staticClass:"detail-item"},[a("h4",[t._v("申訴時間")]),a("p",[t._v(t._s(t.formatDate(t.currentAppeal.createTime,!0)))])]),a("div",{staticClass:"detail-item"},[a("h4",[t._v("申訴內容")]),a("p",[t._v(t._s(t.currentAppeal.appealContent))])]),a("div",{staticClass:"detail-item"},[a("h4",[t._v("申訴狀態")]),a("p",[a("el-tag",{attrs:{type:t.getStatusType(t.currentAppeal.status)}},[t._v(" "+t._s(t.getStatusText(t.currentAppeal.status))+" ")])],1)]),0!==t.currentAppeal.status?[a("div",{staticClass:"detail-item"},[a("h4",[t._v("管理員回覆")]),a("p",[t._v(t._s(t.currentAppeal.adminReply||"無"))])]),a("div",{staticClass:"detail-item"},[a("h4",[t._v("回覆時間")]),a("p",[t._v(t._s(t.currentAppeal.replyTime?t.formatDate(t.currentAppeal.replyTime,!0):"-"))])])]:t._e()],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("關閉")])],1)])],1)},s=[],r=a("5530"),i=(a("99af"),a("e9c4"),a("b64b"),a("4d90"),a("2f62")),o=a("227f"),l=a("58d9"),p={name:"AppealCreate",data:function(){return{loading:!1,appealsLoading:!1,hasSuspension:!1,suspensionReason:"",suspensionStartDate:null,suspensionEndDate:null,suspensionId:null,appealForm:{userid:null,suspensionid:null,appealContent:""},rules:{appealContent:[{required:!0,message:"請輸入申訴內容",trigger:"blur"},{min:10,message:"申訴內容不能少於10個字符",trigger:"blur"}]},appeals:[],dialogVisible:!1,currentAppeal:{}}},computed:Object(r["a"])({},Object(i["b"])(["id"])),created:function(){console.log("User ID from store:",this.id),this.appealForm.userid=this.id,this.checkSuspensionStatus(),this.fetchAppeals()},methods:{checkSuspensionStatus:function(){var t=this;this.loading=!0,Object(o["a"])(this.id).then((function(e){if(t.loading=!1,0===e.status&&e.data){t.hasSuspension=!0;var a=e.data;t.suspensionReason=a.suspensionReason,t.suspensionStartDate=a.startDate,t.suspensionEndDate=a.endDate,t.suspensionId=a.suspensionid,t.appealForm.suspensionid=a.suspensionid}else t.hasSuspension=!1})).catch((function(){t.loading=!1,t.$message.error("獲取停權狀態失敗")}))},fetchAppeals:function(){var t=this;this.appealsLoading=!0,Object(l["e"])(this.id).then((function(e){t.appealsLoading=!1,0===e.code?t.appeals=e.data:t.$message.error("獲取申訴記錄失敗")})).catch((function(){t.appealsLoading=!1,t.$message.error("獲取申訴記錄失敗")}))},submitAppeal:function(){var t=this;this.$refs.appealForm.validate((function(e){e&&(t.loading=!0,Object(l["b"])(t.appealForm).then((function(e){t.loading=!1,0===e.status?(t.$message.success("申訴提交成功"),t.resetForm(),t.fetchAppeals()):t.$message.error(e.message||"申訴提交失敗")})).catch((function(){t.loading=!1,t.$message.error("申訴提交失敗")})))}))},resetForm:function(){this.$refs.appealForm.resetFields()},viewAppealDetails:function(t){this.currentAppeal=JSON.parse(JSON.stringify(t)),this.dialogVisible=!0},formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t)return"-";var a=new Date(t),n=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0");if(!e)return"".concat(n,"-").concat(s,"-").concat(r);var i=String(a.getHours()).padStart(2,"0"),o=String(a.getMinutes()).padStart(2,"0"),l=String(a.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(s,"-").concat(r," ").concat(i,":").concat(o,":").concat(l)},getStatusType:function(t){var e={0:"info",1:"success",2:"danger"};return e[t]||"info"},getStatusText:function(t){var e={0:"待處理",1:"已批准",2:"已拒絕"};return e[t]||"未知"}}},u=p,c=(a("f775"),a("2877")),d=Object(c["a"])(u,n,s,!1,null,"3b59c6ca",null);e["default"]=d.exports},"227f":function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var n=a("b775");function s(t){return Object(n["a"])({url:"/suspension/checkUserSuspension",method:"get",params:{userId:t}})}},"4d90":function(t,e,a){"use strict";var n=a("23e7"),s=a("0ccb").start,r=a("9a0c");n({target:"String",proto:!0,forced:r},{padStart:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}})},"58d9":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"e",(function(){return r})),a.d(e,"c",(function(){return i})),a.d(e,"d",(function(){return o})),a.d(e,"a",(function(){return l})),a.d(e,"f",(function(){return p}));var n=a("b775");function s(t){return Object(n["a"])({url:"/appeal/createAppeal",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/appeal/getUserAppeals",method:"get",params:{userId:t}})}function i(){return Object(n["a"])({url:"/appeal/getAllAppeals",method:"get"})}function o(t){return Object(n["a"])({url:"/appeal/getAppealsByStatus",method:"get",params:{status:t}})}function l(t,e){return Object(n["a"])({url:"/appeal/approveAppeal",method:"post",params:{appealId:t,adminReply:e}})}function p(t,e){return Object(n["a"])({url:"/appeal/rejectAppeal",method:"post",params:{appealId:t,adminReply:e}})}},8258:function(t,e,a){},"9a0c":function(t,e,a){var n=a("342f");t.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n)},e9c4:function(t,e,a){var n=a("23e7"),s=a("d066"),r=a("d039"),i=s("JSON","stringify"),o=/[\uD800-\uDFFF]/g,l=/^[\uD800-\uDBFF]$/,p=/^[\uDC00-\uDFFF]$/,u=function(t,e,a){var n=a.charAt(e-1),s=a.charAt(e+1);return l.test(t)&&!p.test(s)||p.test(t)&&!l.test(n)?"\\u"+t.charCodeAt(0).toString(16):t},c=r((function(){return'"\\udf06\\ud834"'!==i("\udf06\ud834")||'"\\udead"'!==i("\udead")}));i&&n({target:"JSON",stat:!0,forced:c},{stringify:function(t,e,a){var n=i.apply(null,arguments);return"string"==typeof n?n.replace(o,u):n}})},f775:function(t,e,a){"use strict";a("8258")}}]);