(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b3b73d4"],{"0ccb":function(t,e,r){var n=r("50c4"),o=r("1148"),a=r("1d80"),s=Math.ceil,i=function(t){return function(e,r,i){var c,u,l=String(a(e)),d=l.length,f=void 0===i?" ":String(i),p=n(r);return p<=d||""==f?l:(c=p-d,u=o.call(f,s(c/f.length)),u.length>c&&(u=u.slice(0,c)),t?l+u:u+l)}};t.exports={start:i(!1),end:i(!0)}},1148:function(t,e,r){"use strict";var n=r("a691"),o=r("1d80");t.exports="".repeat||function(t){var e=String(o(this)),r="",a=n(t);if(a<0||a==1/0)throw RangeError("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(e+=e))1&a&&(r+=e);return r}},"466d":function(t,e,r){"use strict";var n=r("d784"),o=r("825a"),a=r("50c4"),s=r("1d80"),i=r("8aa5"),c=r("14c3");n("match",1,(function(t,e,r){return[function(e){var r=s(this),n=void 0==e?void 0:e[t];return void 0!==n?n.call(e,r):new RegExp(e)[t](String(r))},function(t){var n=r(e,t,this);if(n.done)return n.value;var s=o(t),u=String(this);if(!s.global)return c(s,u);var l=s.unicode;s.lastIndex=0;var d,f=[],p=0;while(null!==(d=c(s,u))){var h=String(d[0]);f[p]=h,""===h&&(s.lastIndex=i(u,a(s.lastIndex),l)),p++}return 0===p?null:f}]}))},"4d90":function(t,e,r){"use strict";var n=r("23e7"),o=r("0ccb").start,a=r("9a0c");n({target:"String",proto:!0,forced:a},{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},6517:function(t,e,r){"use strict";r.d(e,"e",(function(){return o})),r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return s})),r.d(e,"a",(function(){return i})),r.d(e,"f",(function(){return c})),r.d(e,"d",(function(){return u}));var n=r("b775");function o(t){return Object(n["a"])({url:"/borrow/queryBorrowsByPage",method:"get",params:t})}function a(t){return Object(n["a"])({url:"/borrow/deleteBorrow",method:"delete",data:t})}function s(t){return Object(n["a"])({url:"/borrow/deleteBorrows",method:"delete",data:t})}function i(t,e){return Object(n["a"])({url:"/borrow/borrowBook",method:"post",params:{userid:t,bookid:e}})}function c(t,e){return Object(n["a"])({url:"/borrow/returnBook",method:"post",params:{borrowid:t,bookid:e}})}function u(t,e){return Object(n["a"])({url:"/borrow/extendBorrow",method:"post",params:{borrowid:t,bookid:e}})}},"94f2":function(t,e,r){},"9a0c":function(t,e,r){var n=r("342f");t.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(n)},f1f3:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app-container"},[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[t._v("借閱狀態")])]),r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.canBorrow?r("el-alert",{attrs:{title:"您目前可以借閱圖書",type:"success","show-icon":"",closable:!1}}):r("el-alert",{attrs:{title:t.suspensionReason,type:"error","show-icon":"",closable:!1}},[r("p",[t._v("停權開始時間: "+t._s(t.formatDate(t.suspensionStartDate)))]),r("p",[t._v("停權結束時間: "+t._s(t.formatDate(t.suspensionEndDate)))]),r("p",[t._v("請及時歸還書籍並避免超期還書。若有疑問，請聯繫管理員。")])]),r("div",{staticClass:"borrow-info",staticStyle:{"margin-top":"20px"}},[r("h3",[t._v("借閱須知：")]),r("ul",[r("li",[t._v("每位讀者最多可同時借閱5本書")]),r("li",[t._v("標準借閱期限為30天")]),r("li",[t._v("每本書可延長借閱一次，延長期限為14天")]),r("li",[t._v("超期歸還將會被停權，停權天數為超期天數的兩倍")]),r("li",[t._v("停權期間無法借閱或延長借閱")])])])],1)]),r("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"20px"}},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[t._v("當前借閱")]),r("el-button",{staticStyle:{float:"right",padding:"3px 0","margin-left":"10px"},attrs:{type:"text"},on:{click:t.refreshBorrows}},[t._v("刷新")])],1),r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.borrowsLoading,expression:"borrowsLoading"}]},[t.currentBorrows.length>0?r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.currentBorrows,border:""}},[r("el-table-column",{attrs:{prop:"bookname",label:"書籍名稱","show-overflow-tooltip":""}}),r("el-table-column",{attrs:{prop:"borrowtimestr",label:"借閱時間"}}),r("el-table-column",{attrs:{prop:"expectedReturnTimeStr",label:"預計歸還時間"}}),r("el-table-column",{attrs:{label:"借閱狀態"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isOverdue(e.row.expectedReturnTime)?r("span",{staticStyle:{color:"red"}},[t._v("已超期")]):1===e.row.isExtended?r("span",{staticStyle:{color:"#E6A23C"}},[t._v("已延長")]):r("span",{staticStyle:{color:"#409EFF"}},[t._v("借閱中")])]}}],null,!1,3968200999)}),r("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"success",size:"small"},on:{click:function(r){return t.handleReturn(e.row)}}},[t._v("歸還書籍")]),t.canBorrow&&!t.isOverdue(e.row.expectedReturnTime)&&1!==e.row.isExtended?r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){return t.handleExtend(e.row)}}},[t._v("延長借閱")]):t._e()]}}],null,!1,1835153083)})],1):r("div",{staticClass:"empty-result"},[r("i",{staticClass:"el-icon-document"}),r("p",[t._v("暫無借閱記錄")])])],1)])],1)},o=[],a=r("5530"),s=(r("99af"),r("4de4"),r("d3b7"),r("ac1f"),r("466d"),r("4d90"),r("0643"),r("2382"),r("2f62")),i=r("6517"),c=r("b775");function u(t){return Object(c["a"])({url:"/suspension/checkUserSuspension",method:"get",params:{userId:t}})}var l={name:"BorrowStatus",data:function(){return{loading:!1,borrowsLoading:!1,canBorrow:!0,suspensionReason:"",suspensionStartDate:null,suspensionEndDate:null,currentBorrows:[]}},computed:Object(a["a"])({},Object(s["b"])(["id"])),created:function(){this.fetchBorrowStatus(),this.fetchCurrentBorrows()},methods:{fetchBorrowStatus:function(){var t=this;this.loading=!0,u(this.id).then((function(e){if(t.loading=!1,0===e.status)t.canBorrow=!0;else if(1===e.status){var r,n;t.canBorrow=!1;var o=e.message;t.suspensionReason=o.split("，")[0];var a=null===(r=o.match(/停權開始時間: (.*?)，/))||void 0===r?void 0:r[1],s=null===(n=o.match(/停權結束時間: (.*)/))||void 0===n?void 0:n[1];a&&(t.suspensionStartDate=new Date(a)),s&&(t.suspensionEndDate=new Date(s))}else t.$message.error("獲取借閱狀態失敗")})).catch((function(){t.loading=!1,t.$message.error("獲取借閱狀態失敗")}))},fetchCurrentBorrows:function(){var t=this;this.borrowsLoading=!0;var e={page:1,limit:10,userid:this.id};Object(i["e"])(e).then((function(e){t.borrowsLoading=!1,0===e.code?t.currentBorrows=e.data.filter((function(t){return null===t.returntimestr||""===t.returntimestr})):t.$message.error("獲取借閱記錄失敗")})).catch((function(){t.borrowsLoading=!1,t.$message.error("獲取借閱記錄失敗")}))},refreshBorrows:function(){this.fetchBorrowStatus(),this.fetchCurrentBorrows()},formatDate:function(t){if(!t)return"-";var e=new Date(t),r=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(r,"-").concat(n,"-").concat(o)},isOverdue:function(t){if(!t)return!1;var e=new Date(t),r=new Date;return r>e},handleReturn:function(t){var e=this;this.$confirm("確定要歸還此書嗎?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(i["f"])(t.borrowid,t.bookid).then((function(t){0===t.status?(e.$message.success(t.message||"歸還成功"),e.refreshBorrows()):e.$message.error(t.message||"歸還失敗")}))}))},handleExtend:function(t){var e=this;this.$confirm("確定要延長此書的借閱期限嗎？延長後可再借閱 14 天","延長借閱",{confirmButtonText:"確定延長",cancelButtonText:"取消",type:"info"}).then((function(){Object(i["d"])(t.borrowid,t.bookid).then((function(t){0===t.status?(e.$message.success(t.message||"延長借閱成功"),e.refreshBorrows()):e.$message.error(t.message||"延長借閱失敗")}))}))}}},d=l,f=(r("ff25"),r("2877")),p=Object(f["a"])(d,n,o,!1,null,"08eb8dda",null);e["default"]=p.exports},ff25:function(t,e,r){"use strict";r("94f2")}}]);